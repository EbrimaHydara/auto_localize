var MarkerClusterer=function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function i(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}var s=function(){function t(i,s){e(this,t),i.getMarkerClusterer().extend(t,google.maps.OverlayView),this.cluster_=i,this.className_=i.getMarkerClusterer().getClusterClass(),this.styles_=s,this.center_=null,this.div_=null,this.sums_=null,this.visible_=!1,this.setMap(i.getMap())}return i(t,[{key:"onAdd",value:function(){var e,t,i=this,s=google.maps.version.split(".");s=parseInt(100*s[0],10)+parseInt(s[1],10),this.div_=document.createElement("div"),this.div_.className=this.className_,this.visible_&&this.show(),this.getPanes().overlayMouseTarget.appendChild(this.div_),this.boundsChangedListener_=google.maps.event.addListener(this.getMap(),"bounds_changed",(function(){t=e})),google.maps.event.addDomListener(this.div_,"mousedown",(function(){e=!0,t=!1})),s>=332&&google.maps.event.addDomListener(this.div_,"touchstart",(function(e){e.stopPropagation()})),google.maps.event.addDomListener(this.div_,"click",(function(s){if(e=!1,!t){var n,r,a=i.cluster_.getMarkerClusterer();google.maps.event.trigger(a,"click",i.cluster_),google.maps.event.trigger(a,"clusterclick",i.cluster_),a.getZoomOnClick()&&(r=a.getMaxZoom(),n=i.cluster_.getBounds(),a.getMap().fitBounds(n),setTimeout((function(){a.getMap().fitBounds(n),null!==r&&a.getMap().getZoom()>r&&a.getMap().setZoom(r+1)}),100)),s.cancelBubble=!0,s.stopPropagation&&s.stopPropagation()}})),google.maps.event.addDomListener(this.div_,"mouseover",(function(){var e=i.cluster_.getMarkerClusterer();google.maps.event.trigger(e,"mouseover",i.cluster_)})),google.maps.event.addDomListener(this.div_,"mouseout",(function(){var e=i.cluster_.getMarkerClusterer();google.maps.event.trigger(e,"mouseout",i.cluster_)}))}},{key:"onRemove",value:function(){this.div_&&this.div_.parentNode&&(this.hide(),google.maps.event.removeListener(this.boundsChangedListener_),google.maps.event.clearInstanceListeners(this.div_),this.div_.parentNode.removeChild(this.div_),this.div_=null)}},{key:"draw",value:function(){if(this.visible_){var e=this.getPosFromLatLng_(this.center_);this.div_.style.top=e.y+"px",this.div_.style.left=e.x+"px"}}},{key:"hide",value:function(){this.div_&&(this.div_.style.display="none"),this.visible_=!1}},{key:"show",value:function(){if(this.div_){var e=this.cluster_.markerClusterer_.ariaLabelFn(this.sums_.text),t="",i=this.backgroundPosition_.split(" "),s=parseInt(i[0].replace(/^\s+|\s+$/g,""),10),n=parseInt(i[1].replace(/^\s+|\s+$/g,""),10),r=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(r),t="<img aria-hidden='true' src='"+this.url_+"' style='position: absolute; top: "+n+"px; left: "+s+"px; ",this.cluster_.getMarkerClusterer().enableRetinaIcons_?t+="width: "+this.width_+"px; height: "+this.height_+"px;":t+="clip: rect("+-1*n+"px, "+(-1*s+this.width_)+"px, "+(-1*n+this.height_)+"px, "+-1*s+"px);",t+="'>",this.div_.innerHTML=t+"<div aria-label='"+e+"' tabindex='0' style='position: absolute;top: "+this.anchorText_[0]+"px;left: "+this.anchorText_[1]+"px;color: "+this.textColor_+";font-size: "+this.textSize_+"px;font-family: "+this.fontFamily_+";font-weight: "+this.fontWeight_+";font-style: "+this.fontStyle_+";text-decoration: "+this.textDecoration_+";text-align: center;width: "+this.width_+"px;line-height:"+this.height_+"px;'><span aria-hidden='true'>"+this.sums_.text+"</span></div>",void 0===this.sums_.title||""===this.sums_.title?this.div_.title=this.cluster_.getMarkerClusterer().getTitle():this.div_.title=this.sums_.title,this.div_.style.display=""}this.visible_=!0}},{key:"useStyle",value:function(e){this.sums_=e;var t=Math.max(0,e.index-1);t=Math.min(this.styles_.length-1,t);var i=this.styles_[t];this.url_=i.url,this.height_=i.height,this.width_=i.width,this.anchorText_=i.anchorText||[0,0],this.anchorIcon_=i.anchorIcon||[parseInt(this.height_/2,10),parseInt(this.width_/2,10)],this.textColor_=i.textColor||"black",this.textSize_=i.textSize||11,this.textDecoration_=i.textDecoration||"none",this.fontWeight_=i.fontWeight||"bold",this.fontStyle_=i.fontStyle||"normal",this.fontFamily_=i.fontFamily||"Arial,sans-serif",this.backgroundPosition_=i.backgroundPosition||"0 0"}},{key:"setCenter",value:function(e){this.center_=e}},{key:"createCss",value:function(e){var t=[];return t.push("z-index: "+this.cluster_.markerClusterer_.getZIndex()+";"),t.push("cursor: pointer;"),t.push("position: absolute; top: "+e.y+"px; left: "+e.x+"px;"),t.push("width: "+this.width_+"px; height: "+this.height_+"px;"),t.push("-webkit-user-select: none;"),t.push("-khtml-user-select: none;"),t.push("-moz-user-select: none;"),t.push("-o-user-select: none;"),t.push("user-select: none;"),t.join("")}},{key:"getPosFromLatLng_",value:function(e){var t=this.getProjection().fromLatLngToDivPixel(e);return t.x-=this.anchorIcon_[1],t.y-=this.anchorIcon_[0],t.x=parseInt(t.x,10),t.y=parseInt(t.y,10),t}}]),t}(),n=function(){function t(i){e(this,t),this.markerClusterer_=i,this.map_=i.getMap(),this.gridSize_=i.getGridSize(),this.minClusterSize_=i.getMinimumClusterSize(),this.averageCenter_=i.getAverageCenter(),this.markers_=[],this.center_=null,this.bounds_=null,this.clusterIcon_=new s(this,i.getStyles())}return i(t,[{key:"getSize",value:function(){return this.markers_.length}},{key:"getMarkers",value:function(){return this.markers_}},{key:"getCenter",value:function(){return this.center_}},{key:"getMap",value:function(){return this.map_}},{key:"getMarkerClusterer",value:function(){return this.markerClusterer_}},{key:"getBounds",value:function(){var e,t=new google.maps.LatLngBounds(this.center_,this.center_),i=this.getMarkers();for(e=0;e<i.length;e++)t.extend(i[e].getPosition());return t}},{key:"remove",value:function(){this.clusterIcon_.setMap(null),this.markers_=[],delete this.markers_}},{key:"addMarker",value:function(e){var t,i,s;if(this.isMarkerAlreadyAdded_(e))return!1;if(this.center_){if(this.averageCenter_){var n=this.markers_.length+1,r=(this.center_.lat()*(n-1)+e.getPosition().lat())/n,a=(this.center_.lng()*(n-1)+e.getPosition().lng())/n;this.center_=new google.maps.LatLng(r,a),this.calculateBounds_()}}else this.center_=e.getPosition(),this.calculateBounds_();if(e.isAdded=!0,this.markers_.push(e),i=this.markers_.length,null!==(s=this.markerClusterer_.getMaxZoom())&&this.map_.getZoom()>s)e.getMap()!==this.map_&&e.setMap(this.map_);else if(i<this.minClusterSize_)e.getMap()!==this.map_&&e.setMap(this.map_);else if(i===this.minClusterSize_)for(t=0;t<i;t++)this.markers_[t].setMap(null);else e.setMap(null);return this.updateIcon_(),!0}},{key:"isMarkerInClusterBounds",value:function(e){return this.bounds_.contains(e.getPosition())}},{key:"calculateBounds_",value:function(){var e=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(e)}},{key:"updateIcon_",value:function(){var e=this.markers_.length,t=this.markerClusterer_.getMaxZoom();if(null!==t&&this.map_.getZoom()>t)this.clusterIcon_.hide();else if(e<this.minClusterSize_)this.clusterIcon_.hide();else{var i=this.markerClusterer_.getStyles().length,s=this.markerClusterer_.getCalculator()(this.markers_,i);this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.useStyle(s),this.clusterIcon_.show()}}},{key:"isMarkerAlreadyAdded_",value:function(e){var t;if(this.markers_.indexOf)return-1!==this.markers_.indexOf(e);for(t=0;t<this.markers_.length;t++)if(e===this.markers_[t])return!0;return!1}}]),t}();return function(){function t(i,s,n){e(this,t),this.extend(t,google.maps.OverlayView),s=s||[],n=n||{},this.BATCH_SIZE=2e3,this.BATCH_SIZE_IE=500,this.IMAGE_PATH="../images/m",this.IMAGE_EXTENSION="png",this.IMAGE_SIZES=[53,56,66,78,90],this.markers_=[],this.clusters_=[],this.listeners_=[],this.activeMap_=null,this.ready_=!1,this.ariaLabelFn=n.ariaLabelFn||function(){return""},this.zIndex_=n.zIndex||google.maps.Marker.MAX_ZINDEX+1,this.gridSize_=n.gridSize||60,this.minClusterSize_=n.minimumClusterSize||2,this.maxZoom_=n.maxZoom||null,this.styles_=n.styles||[],this.title_=n.title||"",this.zoomOnClick_=!0,void 0!==n.zoomOnClick&&(this.zoomOnClick_=n.zoomOnClick),this.averageCenter_=!1,void 0!==n.averageCenter&&(this.averageCenter_=n.averageCenter),this.ignoreHidden_=!1,void 0!==n.ignoreHidden&&(this.ignoreHidden_=n.ignoreHidden),this.enableRetinaIcons_=!1,void 0!==n.enableRetinaIcons&&(this.enableRetinaIcons_=n.enableRetinaIcons),this.imagePath_=n.imagePath||this.IMAGE_PATH,this.imageExtension_=n.imageExtension||this.IMAGE_EXTENSION,this.imageSizes_=n.imageSizes||this.IMAGE_SIZES,this.calculator_=n.calculator||this.CALCULATOR,this.batchSize_=n.batchSize||this.BATCH_SIZE,this.batchSizeIE_=n.batchSizeIE||this.BATCH_SIZE_IE,this.clusterClass_=n.clusterClass||"cluster",-1!==navigator.userAgent.toLowerCase().indexOf("msie")&&(this.batchSize_=this.batchSizeIE_),this.setupStyles_(),this.addMarkers(s,!0),this.setMap(i)}return i(t,[{key:"onAdd",value:function(){var e=this;this.activeMap_=this.getMap(),this.ready_=!0,this.repaint(),this.prevZoom_=this.getMap().getZoom(),this.listeners_=[google.maps.event.addListener(this.getMap(),"zoom_changed",function(){var e=this.getMap().getZoom(),t=this.getMap().minZoom||0,i=Math.min(this.getMap().maxZoom||100,this.getMap().mapTypes[this.getMap().getMapTypeId()].maxZoom);e=Math.min(Math.max(e,t),i),this.prevZoom_!=e&&(this.prevZoom_=e,this.resetViewport_(!1))}.bind(this)),google.maps.event.addListener(this.getMap(),"idle",(function(){e.redraw_()}))]}},{key:"onRemove",value:function(){var e;for(e=0;e<this.markers_.length;e++)this.markers_[e].getMap()!==this.activeMap_&&this.markers_[e].setMap(this.activeMap_);for(e=0;e<this.clusters_.length;e++)this.clusters_[e].remove();for(this.clusters_=[],e=0;e<this.listeners_.length;e++)google.maps.event.removeListener(this.listeners_[e]);this.listeners_=[],this.activeMap_=null,this.ready_=!1}},{key:"draw",value:function(){}},{key:"setupStyles_",value:function(){var e,t;if(!(this.styles_.length>0))for(e=0;e<this.imageSizes_.length;e++)t=this.imageSizes_[e],this.styles_.push({url:this.imagePath_+(e+1)+"."+this.imageExtension_,height:t,width:t})}},{key:"fitMapToMarkers",value:function(){var e,t=this.getMarkers(),i=new google.maps.LatLngBounds;for(e=0;e<t.length;e++)!t[e].getVisible()&&this.getIgnoreHidden()||i.extend(t[e].getPosition());this.getMap().fitBounds(i)}},{key:"getGridSize",value:function(){return this.gridSize_}},{key:"setGridSize",value:function(e){this.gridSize_=e}},{key:"getMinimumClusterSize",value:function(){return this.minClusterSize_}},{key:"setMinimumClusterSize",value:function(e){this.minClusterSize_=e}},{key:"getMaxZoom",value:function(){return this.maxZoom_}},{key:"setMaxZoom",value:function(e){this.maxZoom_=e}},{key:"getZIndex",value:function(){return this.zIndex_}},{key:"setZIndex",value:function(e){this.zIndex_=e}},{key:"getStyles",value:function(){return this.styles_}},{key:"setStyles",value:function(e){this.styles_=e}},{key:"getTitle",value:function(){return this.title_}},{key:"setTitle",value:function(e){this.title_=e}},{key:"getZoomOnClick",value:function(){return this.zoomOnClick_}},{key:"setZoomOnClick",value:function(e){this.zoomOnClick_=e}},{key:"getAverageCenter",value:function(){return this.averageCenter_}},{key:"setAverageCenter",value:function(e){this.averageCenter_=e}},{key:"getIgnoreHidden",value:function(){return this.ignoreHidden_}},{key:"setIgnoreHidden",value:function(e){this.ignoreHidden_=e}},{key:"getEnableRetinaIcons",value:function(){return this.enableRetinaIcons_}},{key:"setEnableRetinaIcons",value:function(e){this.enableRetinaIcons_=e}},{key:"getImageExtension",value:function(){return this.imageExtension_}},{key:"setImageExtension",value:function(e){this.imageExtension_=e}},{key:"getImagePath",value:function(){return this.imagePath_}},{key:"setImagePath",value:function(e){this.imagePath_=e}},{key:"getImageSizes",value:function(){return this.imageSizes_}},{key:"setImageSizes",value:function(e){this.imageSizes_=e}},{key:"getCalculator",value:function(){return this.calculator_}},{key:"setCalculator",value:function(e){this.calculator_=e}},{key:"getBatchSizeIE",value:function(){return this.batchSizeIE_}},{key:"setBatchSizeIE",value:function(e){this.batchSizeIE_=e}},{key:"getClusterClass",value:function(){return this.clusterClass_}},{key:"setClusterClass",value:function(e){this.clusterClass_=e}},{key:"getMarkers",value:function(){return this.markers_}},{key:"getTotalMarkers",value:function(){return this.markers_.length}},{key:"getClusters",value:function(){return this.clusters_}},{key:"getTotalClusters",value:function(){return this.clusters_.length}},{key:"addMarker",value:function(e,t){this.pushMarkerTo_(e),t||this.redraw_()}},{key:"addMarkers",value:function(e,t){var i;for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&this.pushMarkerTo_(e[i]);t||this.redraw_()}},{key:"pushMarkerTo_",value:function(e){if(e.getDraggable()){var t=this;google.maps.event.addListener(e,"dragend",(function(){t.ready_&&(this.isAdded=!1,t.repaint())}))}e.isAdded=!1,this.markers_.push(e)}},{key:"removeMarker",value:function(e,t){var i=this.removeMarker_(e);return!t&&i&&this.repaint(),i}},{key:"removeMarkers",value:function(e,t){var i,s,n=!1;for(i=0;i<e.length;i++)s=this.removeMarker_(e[i]),n=n||s;return!t&&n&&this.repaint(),n}},{key:"removeMarker_",value:function(e){var t,i=-1;if(this.markers_.indexOf)i=this.markers_.indexOf(e);else for(t=0;t<this.markers_.length;t++)if(e===this.markers_[t]){i=t;break}return-1!==i&&(e.setMap(null),this.markers_.splice(i,1),!0)}},{key:"clearMarkers",value:function(){this.resetViewport_(!0),this.markers_=[]}},{key:"repaint",value:function(){var e=this.clusters_.slice();this.clusters_=[],this.resetViewport_(!1),this.redraw_(),setTimeout((function(){var t;for(t=0;t<e.length;t++)e[t].remove()}),0)}},{key:"getExtendedBounds",value:function(e){var t=this.getProjection(),i=new google.maps.LatLng(e.getNorthEast().lat(),e.getNorthEast().lng()),s=new google.maps.LatLng(e.getSouthWest().lat(),e.getSouthWest().lng()),n=t.fromLatLngToDivPixel(i);n.x+=this.gridSize_,n.y-=this.gridSize_;var r=t.fromLatLngToDivPixel(s);r.x-=this.gridSize_,r.y+=this.gridSize_;var a=t.fromDivPixelToLatLng(n),o=t.fromDivPixelToLatLng(r);return e.extend(a),e.extend(o),e}},{key:"redraw_",value:function(){this.createClusters_(0)}},{key:"resetViewport_",value:function(e){var t,i;for(t=0;t<this.clusters_.length;t++)this.clusters_[t].remove();for(this.clusters_=[],t=0;t<this.markers_.length;t++)(i=this.markers_[t]).isAdded=!1,e&&i.setMap(null)}},{key:"distanceBetweenPoints_",value:function(e,t){var i=(t.lat()-e.lat())*Math.PI/180,s=(t.lng()-e.lng())*Math.PI/180,n=Math.sin(i/2)*Math.sin(i/2)+Math.cos(e.lat()*Math.PI/180)*Math.cos(t.lat()*Math.PI/180)*Math.sin(s/2)*Math.sin(s/2);return 6371*(2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)))}},{key:"isMarkerInBounds_",value:function(e,t){return t.contains(e.getPosition())}},{key:"addToClosestCluster_",value:function(e){var t,i,s,r,a=4e4,o=null;for(t=0;t<this.clusters_.length;t++)(r=(s=this.clusters_[t]).getCenter())&&(i=this.distanceBetweenPoints_(r,e.getPosition()))<a&&(a=i,o=s);o&&o.isMarkerInClusterBounds(e)?o.addMarker(e):((s=new n(this)).addMarker(e),this.clusters_.push(s))}},{key:"createClusters_",value:function(e){var t,i,s,n=this;if(this.ready_){0===e&&(google.maps.event.trigger(this,"clusteringbegin",this),void 0!==this.timerRefStatic&&(clearTimeout(this.timerRefStatic),delete this.timerRefStatic)),s=this.getMap().getZoom()>3?new google.maps.LatLngBounds(this.getMap().getBounds().getSouthWest(),this.getMap().getBounds().getNorthEast()):new google.maps.LatLngBounds(new google.maps.LatLng(85.02070771743472,-178.48388434375),new google.maps.LatLng(-85.08136444384544,178.00048865625));var r=this.getExtendedBounds(s),a=Math.min(e+this.batchSize_,this.markers_.length);for(t=e;t<a;t++)!(i=this.markers_[t]).isAdded&&this.isMarkerInBounds_(i,r)&&(!this.ignoreHidden_||this.ignoreHidden_&&i.getVisible())&&this.addToClosestCluster_(i);a<this.markers_.length?this.timerRefStatic=setTimeout((function(){n.createClusters_(a)}),0):(delete this.timerRefStatic,google.maps.event.trigger(this,"clusteringend",this))}}},{key:"extend",value:function(e,t){return function(e){var t;for(t in e.prototype)this.prototype[t]=e.prototype[t];return this}.apply(e,[t])}},{key:"CALCULATOR",value:function(e,t){for(var i=0,s=e.length.toString(),n=s;0!==n;)n=parseInt(n/10,10),i++;return{text:s,index:i=Math.min(i,t),title:""}}}]),t}()}();
